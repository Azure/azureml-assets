name: Docker-Daily

on:
  push:
    branches:
    - elesel/start-general-envs
  schedule:
    - cron: '30 6,18 * * *' # 2x daily
  workflow_dispatch:
    inputs:
      linux_image_dirs:
        description: Linux image directories
        default: general/src/environments
        required: true
      windows_image_dirs:
        description: Windows image directories
        default: general/src/environments
        required: true

defaults:
  run:
    shell: bash

jobs:
  # Build Linux-based images
  build-push-linux:
    name: Build Linux images
    uses: Azure/azureml-assets/.github/workflows/docker-actions.yml@elesel/start-general-envs
    with:
      machine_type: ubuntu-latest
      os_to_build: linux
      image_dirs: ${{ github.event.inputs.linux_image_dirs || 'general/src/environments' }}
      build_log_dir: build-logs
      build_artifact_name: build-logs-linux
      #target_image_prefix: ghcr.io/azure/azureml/
  
  # Build Windows-based images
  build-push-windows:
    name: Build Windows images
    uses: Azure/azureml-assets/.github/workflows/docker-actions.yml@elesel/start-general-envs
    with:
      machine_type: windows-2019
      os_to_build: windows
      image_dirs: ${{ github.event.inputs.windows_image_dirs || 'general/src/environments' }}
      build_log_dir: build-logs
      build_artifact_name: build-logs-windows
      #target_image_prefix: ghcr.io/azure/azureml/
