name: Docker-Daily

on:
  schedule:
    - cron: '30 6,18 * * *' # 2x daily
  workflow_dispatch:
    inputs:
      linux_image_dirs:
        description: Linux image directories
        default: src/linux-cpu,src/linux-gpu
        required: true
      windows_image_dirs:
        description: Windows image directories
        default: src/windows
        required: true

defaults:
  run:
    shell: bash

jobs:
  # Build Linux-based images
  build-push-linux:
    name: Build Linux images
    uses: Azure/AzureML-Images/.github/workflows/docker-actions.yml@main
    with:
      machine_type: ubuntu-latest
      image_dirs: ${{ github.event.inputs.linux_image_dirs || 'src/linux-cpu,src/linux-gpu' }}
      build_log_dir: build-logs
      build_artifact_name: build-logs-linux
      #target_image_prefix: ghcr.io/azure/azureml/
  
  # Build Windows-based images
  build-push-windows:
    name: Build Windows images
    uses: Azure/AzureML-Images/.github/workflows/docker-actions.yml@main
    with:
      machine_type: windows-2019
      image_dirs: ${{ github.event.inputs.windows_image_dirs || 'src/windows' }}
      build_log_dir: build-logs
      build_artifact_name: build-logs-windows
      #target_image_prefix: ghcr.io/azure/azureml/
