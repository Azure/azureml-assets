$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json
name: microsoft_gllm_classification_single_label_model_inference_component
version: 0.0.1
type: command

is_deterministic: True

display_name: LLM Single Label Classification Model Inference
description: Component to inference model for single label classification task

environment: azureml:gllm-ptca-aifx-stable-ubuntu2004-cu113-py38-torch1110:0.0.1

code: ../../scripts/inference

distribution:
  type: pytorch

inputs:
  # Sequence Classification task Parameters
  sentence1_key:
    type: string
    optional: true

  sentence2_key:
    type: string
    optional: true

  label_key:
    type: string
    optional: true

  # Inference Parameters
  batch_size:
    type: integer
    default: 1
    optional: true

  # Deepspeed and ORT Params
  apply_ort:
    type: string
    enum:
      - 'true'
      - 'false'
    default: 'false'
    optional: true
    description: If set to true, will use the ONNXRunTime training

  apply_deepspeed:
    type: string
    enum:
      - 'true'
      - 'false'
    default: 'false'
    optional: true
    description: If set to true, will enable deepspeed for training

  deepspeed_config:
    type: uri_file
    optional: true
    description: If apply_deepspeed is set to True, this file will be used as deepspeed config

  # Output of finetune component
  model_path:
    type: uri_folder
    optional: true
    description: folder containing model checkpointing and model related metadata

  # Dataset Parameters
  test_file_path:
    type: uri_file
    optional: false
    description: Test file path

outputs:
  output_dir:
    type: uri_folder
    description: Output dir to save the finetune model and other metadata

command: >-
  python inference.py [--sentence1_key ${{inputs.sentence1_key}}] [--sentence2_key ${{inputs.sentence2_key}}] [--label_key ${{inputs.label_key}}] [--batch_size ${{inputs.batch_size}}] [--apply_ort ${{inputs.apply_ort}}] [--apply_deepspeed ${{inputs.apply_deepspeed}}] [--deepspeed_config ${{inputs.deepspeed_config}}] [--model_path ${{inputs.model_path}}] --test_file_path ${{inputs.test_file_path}} --output_dir ${{outputs.output_dir}}
